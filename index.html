<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Lista de Mascotas</title>
  </head>
  <body>
    <h1>Lista de Mascotas</h1>

    <form id="nuevaMascota">
      <label for="nombreMascota">Nombre de la mascota:</label>
      <input type="text" id="nombreMascota" name="nombreMascota" /><br />

      <label for="runPropietario">RUN del propietario:</label>
      <input type="text" id="runPropietario" name="runPropietario" /><br />

      <label for="nombrePropietario">Nombre del propietario:</label>
      <input type="text" id="nombrePropietario" name="nombrePropietario" /><br />

      <button type="submit">Agregar mascota</button>
    </form>

    <label for="buscarMascota">Buscar mascota por nombre:</label>
    <input type="text" id="buscarMascota" name="buscarMascota">
    <button id="buscarBtn">Buscar</button>
    <br>
    <br>
    <label for="buscarPropietario">Buscar mascota por propietario:</label>
    <input type="text" id="buscarPropietario" name="buscarPropietario">
    <button id="buscarPropietarioBtn">Buscar</button>
    <br>
    <button id="cargarMascotasBtn">Mostrar listado de mascotas</button>



    <ul id="listaMascotas"></ul>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      const form = document.querySelector("#nuevaMascota");
      const lista = document.querySelector("#listaMascotas");
      const mostrarMascotasBtn = document.querySelector("#mostrarMascotas");
      let mascotas = []; // <- variable para almacenar la lista de mascotas

      // Función para cargar la lista de mascotas desde el servidor
      function cargarMascotas() {
        axios.get("http://localhost:3000/mascotas")
          .then((response) => {
            mascotas = response.data.data.mascotas; // <- asignar la lista de mascotas a la variable global
            lista.innerHTML = "";

            if (Array.isArray(mascotas)) {
              mascotas.forEach((mascota) => {
                const item = document.createElement("li");
                item.innerText = `${mascota.nombre} (${mascota.propietario.nombre})`;
                lista.appendChild(item);
              });
            } else {
              console.error("La respuesta del servidor no contiene un arreglo de mascotas.");
            }
          })
          .catch((error) => {
            console.error("Error al cargar la lista de mascotas: ", error);
          });
      }


      const cargarMascotasBtn = document.querySelector("#cargarMascotasBtn");
      cargarMascotasBtn.addEventListener("click", () => {
        cargarMascotas();
      });



     // Agregar evento al botón para buscar mascotas por nombre
     const buscarBtn = document.querySelector("#buscarBtn");
     buscarBtn.addEventListener("click", () => {
      const nombreMascota = document.querySelector("#buscarMascota").value;
      const mascotasFiltradas = mascotas.filter((mascota) =>
      mascota.nombre.toLowerCase().includes(nombreMascota.toLowerCase())
    );

  lista.innerHTML = "";

  if (Array.isArray(mascotasFiltradas)) {
    mascotasFiltradas.forEach((mascota) => {
      const item = document.createElement("li");
      item.innerText = `${mascota.nombre} (${mascota.propietario.nombre})`;
      lista.appendChild(item);
    });
  } else {
    console.error("No se encontraron mascotas con ese nombre.");
  }
});


// Agregar evento al botón para buscar mascotas por nombre del propietario
const buscarPropietarioBtn = document.querySelector("#buscarPropietarioBtn");
buscarPropietarioBtn.addEventListener("click", () => {
  const nombrePropietario = document.querySelector("#buscarPropietario").value;

  const mascotasFiltradas = mascotas.filter((mascota) =>
    mascota.propietario.nombre.toLowerCase().includes(nombrePropietario.toLowerCase())
  );

  lista.innerHTML = "";

  if (Array.isArray(mascotasFiltradas)) {
    mascotasFiltradas.forEach((mascota) => {
      const item = document.createElement("li");
      item.innerText = `${mascota.nombre} (${mascota.propietario.nombre})`;
      lista.appendChild(item);
    });
  } else {
    console.error("No se encontraron mascotas con ese nombre de propietario.");
  }
});






      // Cargar lista de mascotas al cargar la página
      cargarMascotas();

      // Manejar el evento submit del formulario para agregar una mascota
      form.addEventListener("submit", (event) => {
        event.preventDefault();

        const nombreMascota = document.querySelector("#nombreMascota").value;
        const runPropietario = document.querySelector("#runPropietario").value;
        const nombrePropietario = document.querySelector("#nombrePropietario").value;

        axios
          .post("http://localhost:3000/mascotas", {
            mascota: nombreMascota,
            run: runPropietario,
            propietario: nombrePropietario,
          })
          .then((response) => {
            console.log(response.data.message);
            cargarMascotas();
          })
          .catch((error) => {
            console.error(error.response.data.message);
            alert("Debe enviar todos los datos requeridos [nombre mascota, run, nombre propietario]");
          });
      });

      // Añadir evento al botón para mostrar mascotas
      mostrarMascotasBtn.addEventListener("click", () => {
        cargarMascotas();
      });
    </script>
  </body>
</html>
